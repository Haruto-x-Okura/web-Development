<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Calculator with Desmos Graphing</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            display: grid;
            grid-template-columns: 450px 650px;
            gap: 20px;
            max-width: 1300px;
            width: 100%;
        }

        .calculator-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 95vh;
            overflow-y: auto;
        }

        .graph-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        h2 {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Display Screen */
        .display {
            background: #f7f7f7;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            min-height: 60px;
            font-size: 22px;
            text-align: right;
            word-wrap: break-word;
            color: #333;
        }

        /* Button Grid */
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .scientific-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .advanced-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .special-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        /* Button Styles */
        button {
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(0);
        }

        /* Number buttons */
        .btn-number {
            background: #f0f0f0;
            color: #333;
        }

        .btn-number:hover {
            background: #e0e0e0;
        }

        /* Operator buttons */
        .btn-operator {
            background: #667eea;
            color: white;
        }

        .btn-operator:hover {
            background: #5568d3;
        }

        /* Scientific function buttons */
        .btn-function {
            background: #764ba2;
            color: white;
            font-size: 14px;
        }

        .btn-function:hover {
            background: #653a8a;
        }

        /* Advanced function buttons */
        .btn-advanced {
            background: #20c997;
            color: white;
            font-size: 14px;
        }

        .btn-advanced:hover {
            background: #18a87b;
        }

        /* Special buttons */
        .btn-clear {
            background: #ff6b6b;
            color: white;
        }

        .btn-clear:hover {
            background: #ff5252;
        }

        .btn-equals {
            background: #51cf66;
            color: white;
        }

        .btn-equals:hover {
            background: #40c057;
        }

        .btn-graph {
            background: #339af0;
            color: white;
            width: 100%;
            margin-top: 10px;
            padding: 18px;
            font-size: 20px;
        }

        .btn-graph:hover {
            background: #228be6;
        }

        .btn-wide {
            grid-column: span 2;
        }

        /* Desmos Graph Container */
        #calculator {
            width: 100%;
            height: 550px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }

        /* Instructions */
        .instructions {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 13px;
            color: #666;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .section-label {
            font-size: 12px;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }

        @media (max-width: 1100px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Calculator Section -->
        <div class="calculator-section">
            <h1>Scientific Calculator</h1>
            
            <!-- Display -->
            <div class="display" id="display">0</div>
            
            <!-- Trigonometric Functions -->
            <div class="section-label">Trigonometric Functions</div>
            <div class="scientific-buttons">
                <button class="btn-function" onclick="addToDisplay('sin(')">sin</button>
                <button class="btn-function" onclick="addToDisplay('cos(')">cos</button>
                <button class="btn-function" onclick="addToDisplay('tan(')">tan</button>
                <button class="btn-function" onclick="addToDisplay('asin(')">sin‚Åª¬π</button>
                <button class="btn-function" onclick="addToDisplay('acos(')">cos‚Åª¬π</button>
                <button class="btn-function" onclick="addToDisplay('atan(')">tan‚Åª¬π</button>
                <button class="btn-function" onclick="addToDisplay('sinh(')">sinh</button>
                <button class="btn-function" onclick="addToDisplay('cosh(')">cosh</button>
            </div>
            
            <!-- Logarithmic & Exponential Functions -->
            <div class="section-label">Logarithmic & Exponential</div>
            <div class="advanced-buttons">
                <button class="btn-advanced" onclick="addToDisplay('log(')">log</button>
                <button class="btn-advanced" onclick="addToDisplay('ln(')">ln</button>
                <button class="btn-advanced" onclick="addToDisplay('exp(')">eÀ£</button>
                <button class="btn-advanced" onclick="addToDisplay('10^(')">10À£</button>
                <button class="btn-advanced" onclick="addToDisplay('sqrt(')">‚àö</button>
                <button class="btn-advanced" onclick="addToDisplay('cbrt(')">‚àõ</button>
                <button class="btn-advanced" onclick="addToDisplay('abs(')">|x|</button>
                <button class="btn-advanced" onclick="addToDisplay('floor(')">‚åäx‚åã</button>
            </div>
            
            <!-- Powers & Variables -->
            <div class="section-label">Powers & Variables</div>
            <div class="special-buttons">
                <button class="btn-advanced" onclick="addToDisplay('x')">x</button>
                <button class="btn-advanced" onclick="addToDisplay('x^2')">x¬≤</button>
                <button class="btn-advanced" onclick="addToDisplay('x^3')">x¬≥</button>
                <button class="btn-advanced" onclick="addToDisplay('x^(')">x‚Åø</button>
                <button class="btn-advanced" onclick="addToDisplay('1/x')">1/x</button>
                <button class="btn-advanced" onclick="addToDisplay('2^(')">2À£</button>
            </div>

            <!-- Constants -->
            <div class="section-label">Constants</div>
            <div class="special-buttons">
                <button class="btn-advanced" onclick="addToDisplay('3.14159')">œÄ</button>
                <button class="btn-advanced" onclick="addToDisplay('2.71828')">e</button>
                <button class="btn-advanced" onclick="addToDisplay('1.41421')">‚àö2</button>
            </div>
            
            <!-- Main Buttons -->
            <div class="section-label">Basic Operations</div>
            <div class="buttons">
                <button class="btn-number" onclick="addToDisplay('7')">7</button>
                <button class="btn-number" onclick="addToDisplay('8')">8</button>
                <button class="btn-number" onclick="addToDisplay('9')">9</button>
                <button class="btn-operator" onclick="addToDisplay('/')">/</button>
                
                <button class="btn-number" onclick="addToDisplay('4')">4</button>
                <button class="btn-number" onclick="addToDisplay('5')">5</button>
                <button class="btn-number" onclick="addToDisplay('6')">6</button>
                <button class="btn-operator" onclick="addToDisplay('*')">√ó</button>
                
                <button class="btn-number" onclick="addToDisplay('1')">1</button>
                <button class="btn-number" onclick="addToDisplay('2')">2</button>
                <button class="btn-number" onclick="addToDisplay('3')">3</button>
                <button class="btn-operator" onclick="addToDisplay('-')">‚àí</button>
                
                <button class="btn-number" onclick="addToDisplay('0')">0</button>
                <button class="btn-number" onclick="addToDisplay('.')">.</button>
                <button class="btn-operator" onclick="addToDisplay('^')">^</button>
                <button class="btn-operator" onclick="addToDisplay('+')">+</button>
                
                <button class="btn-operator" onclick="addToDisplay('(')">(</button>
                <button class="btn-operator" onclick="addToDisplay(')')">)</button>
                <button class="btn-operator" onclick="addToDisplay('%')">%</button>
                <button class="btn-operator" onclick="addToDisplay('!')">!</button>
            </div>
            
            <!-- Control Buttons -->
            <div class="buttons">
                <button class="btn-clear" onclick="clearDisplay()">Clear</button>
                <button class="btn-clear" onclick="deleteLastChar()">Delete</button>
                <button class="btn-equals btn-wide" onclick="calculate()">Calculate</button>
            </div>
            
            <button class="btn-graph" onclick="graphExpression()">üìä Graph Expression</button>
            
            <!-- Instructions -->
            <div class="instructions">
                <h3>How to Use:</h3>
                <ul>
                    <li>Click buttons or use keyboard to enter expressions</li>
                    <li>Use 'x' as variable for graphing (e.g., x^2, sin(x), x^3)</li>
                    <li>Click "Graph Expression" to visualize on Desmos</li>
                    <li>Supports all trigonometric, logarithmic, and power functions</li>
                    <li>Constants: œÄ (pi), e (Euler's number), ‚àö2</li>
                </ul>
            </div>
        </div>
        
        <!-- Graph Section -->
        <div class="graph-section">
            <h2>Desmos Graph Visualization</h2>
            <div id="calculator"></div>
        </div>
    </div>

    <script>
        // Initialize Desmos Calculator
        let calculator = null;
        let currentExpression = '0';
        let calculatorReady = false;

        // Load Desmos API dynamically
        function loadDesmosAPI() {
            return new Promise((resolve, reject) => {
                // Check if already loaded
                if (typeof Desmos !== 'undefined') {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://www.desmos.com/api/v1.9/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6';
                script.onload = () => {
                    console.log('Desmos API loaded successfully');
                    resolve();
                };
                script.onerror = () => {
                    console.error('Failed to load Desmos API');
                    reject(new Error('Failed to load Desmos API'));
                };
                document.head.appendChild(script);
            });
        }

        // Initialize Desmos calculator
        async function initializeDesmos() {
            try {
                // Load the API
                await loadDesmosAPI();
                
                // Wait a bit for Desmos to be fully ready
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const elt = document.getElementById('calculator');
                
                if (typeof Desmos === 'undefined') {
                    throw new Error('Desmos API not available');
                }
                
                calculator = Desmos.GraphingCalculator(elt, {
                    expressions: true,
                    settingsMenu: true,
                    zoomButtons: true,
                    expressionsCollapsed: false
                });
                
                // Set initial view
                calculator.setMathBounds({
                    left: -10,
                    right: 10,
                    bottom: -10,
                    top: 10
                });
                
                calculatorReady = true;
                console.log('Desmos calculator initialized successfully');
                
                // Show success message in the graph area briefly
                const graphDiv = document.getElementById('calculator');
                const originalBg = graphDiv.style.background;
                graphDiv.style.background = '#e7f5ff';
                setTimeout(() => {
                    graphDiv.style.background = originalBg;
                }, 1000);
                
            } catch (error) {
                console.error('Error initializing Desmos:', error);
                const elt = document.getElementById('calculator');
                elt.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; padding: 20px; text-align: center;">
                        <h3 style="color: #ff6b6b; margin-bottom: 15px;">‚ö†Ô∏è Graph Not Available</h3>
                        <p style="color: #666; margin-bottom: 10px;">The Desmos graphing library failed to load.</p>
                        <p style="color: #666; margin-bottom: 20px;">This might happen in restricted environments.</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            Retry Loading
                        </button>
                        <p style="color: #999; margin-top: 20px; font-size: 14px;">The calculator functions still work!</p>
                    </div>
                `;
            }
        }

        // Initialize when page loads
        window.addEventListener('load', initializeDesmos);

        // Add value to display
        function addToDisplay(value) {
            const display = document.getElementById('display');
            
            // If display shows 0 or result, replace it
            if (currentExpression === '0' || display.classList.contains('result')) {
                currentExpression = value;
                display.classList.remove('result');
            } else {
                currentExpression += value;
            }
            
            display.textContent = currentExpression;
        }

        // Clear display
        function clearDisplay() {
            currentExpression = '0';
            document.getElementById('display').textContent = currentExpression;
            document.getElementById('display').classList.remove('result');
        }

        // Delete last character
        function deleteLastChar() {
            if (currentExpression.length > 1) {
                currentExpression = currentExpression.slice(0, -1);
            } else {
                currentExpression = '0';
            }
            document.getElementById('display').textContent = currentExpression;
        }

        // Factorial function
        function factorial(n) {
            if (n < 0) return NaN;
            if (n === 0 || n === 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        // Calculate expression
        function calculate() {
            const display = document.getElementById('display');
            
            try {
                // Convert display expression to JavaScript-compatible format
                let expr = currentExpression
                    .replace(/\^/g, '**')  // Power operator
                    .replace(/sqrt\(/g, 'Math.sqrt(')
                    .replace(/cbrt\(/g, 'Math.cbrt(')
                    .replace(/sin\(/g, 'Math.sin(')
                    .replace(/cos\(/g, 'Math.cos(')
                    .replace(/tan\(/g, 'Math.tan(')
                    .replace(/asin\(/g, 'Math.asin(')
                    .replace(/acos\(/g, 'Math.acos(')
                    .replace(/atan\(/g, 'Math.atan(')
                    .replace(/sinh\(/g, 'Math.sinh(')
                    .replace(/cosh\(/g, 'Math.cosh(')
                    .replace(/log\(/g, 'Math.log10(')
                    .replace(/ln\(/g, 'Math.log(')
                    .replace(/exp\(/g, 'Math.exp(')
                    .replace(/abs\(/g, 'Math.abs(')
                    .replace(/floor\(/g, 'Math.floor(');
                
                // Handle factorial
                expr = expr.replace(/(\d+)!/g, 'factorial($1)');
                
                // Handle percentage
                expr = expr.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
                
                // Safely evaluate using Function constructor
                const result = Function('factorial', '"use strict"; return (' + expr + ')')(factorial);
                
                currentExpression = result.toString();
                display.textContent = currentExpression;
                display.classList.add('result');
            } catch (error) {
                display.textContent = 'Error';
                currentExpression = '0';
            }
        }

        // Graph expression using Desmos
        function graphExpression() {
            try {
                // Check if calculator is ready
                if (!calculatorReady || !calculator) {
                    alert('‚ö†Ô∏è Graphing Not Available\n\nThe Desmos API failed to load in this environment.\n\nThe calculator still works for calculations!\n\nTo use graphing:\n1. Copy this code to a local HTML file\n2. Open it in your browser\n3. Make sure you have internet connection');
                    return;
                }
                
                // Get the current expression
                let desmosExpr = currentExpression;
                
                // Check if expression is empty or just 0
                if (!desmosExpr || desmosExpr === '0') {
                    alert('Please enter an expression first!\n\nTry: x^2 or sin(x) or x^3');
                    return;
                }
                
                // Convert calculator expression to Desmos-compatible format
                desmosExpr = desmosExpr
                    .replace(/sqrt/g, '\\sqrt')
                    .replace(/cbrt/g, '\\sqrt[3]')
                    .replace(/\^/g, '^')
                    .replace(/asin/g, '\\arcsin')
                    .replace(/acos/g, '\\arccos')
                    .replace(/atan/g, '\\arctan')
                    .replace(/sinh/g, '\\sinh')
                    .replace(/cosh/g, '\\cosh')
                    .replace(/abs/g, '\\abs')
                    .replace(/floor/g, '\\floor')
                    .replace(/exp/g, '\\exp')
                    .replace(/\*/g, '\\cdot ')
                    .replace(/ln/g, '\\ln')
                    .replace(/log/g, '\\log');
                
                // Check if expression contains 'x' (variable for graphing)
                if (!desmosExpr.includes('x')) {
                    // If no variable, warn user
                    const result = confirm('No variable "x" found in expression.\n\nGraph as horizontal line y=' + desmosExpr + '?');
                    if (!result) {
                        return;
                    }
                    desmosExpr = 'y=' + desmosExpr;
                } else {
                    // Add y= prefix for proper graphing
                    desmosExpr = 'y=' + desmosExpr;
                }
                
                // Clear previous expressions and add new one
                calculator.setBlank();
                calculator.setExpression({
                    id: 'graph1',
                    latex: desmosExpr,
                    color: Desmos.Colors.BLUE
                });
                
                // Reset view to standard bounds
                calculator.setMathBounds({
                    left: -10,
                    right: 10,
                    bottom: -10,
                    top: 10
                });
                
                console.log('Graphed expression:', desmosExpr);
            } catch (error) {
                alert('Error graphing expression!\n\nTry simpler expressions like:\n‚Ä¢ x^2\n‚Ä¢ sin(x)\n‚Ä¢ x^3-2*x\n\nError: ' + error.message);
                console.error('Graph error:', error);
            }
        }

        // Keyboard support
        document.addEventListener('keydown', function(event) {
            const key = event.key;
            
            // Numbers and operators
            if (/^[0-9+\-*/().]$/.test(key)) {
                addToDisplay(key);
            } else if (key === '^') {
                addToDisplay('^');
            } else if (key === 'x' || key === 'X') {
                addToDisplay('x');
            } else if (key === 'Enter') {
                calculate();
            } else if (key === 'Escape') {
                clearDisplay();
            } else if (key === 'Backspace') {
                event.preventDefault();
                deleteLastChar();
            } else if (key === '%') {
                addToDisplay('%');
            } else if (key === '!') {
                addToDisplay('!');
            }
        });
    </script>
</body>
</html>